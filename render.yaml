# Render Deployment Configuration
# https://render.com/docs/blueprint-spec

services:
  # FastAPI Web Service
  - type: web
    name: plant-disease-detection-api
    runtime: python
    region: oregon
    plan: free
    branch: main
    buildCommand: pip install --upgrade pip && pip install -r requirements.txt
    startCommand: uvicorn app.main:app --host 0.0.0.0 --port $PORT
    
    # Environment Variables
    envVars:
      - key: PYTHON_VERSION
        value: "3.12"
      
      - key: APP_NAME
        value: Plant Disease Detection API
      
      - key: APP_VERSION
        value: 2.0.0
      
      - key: DEBUG
        value: "false"
      
      - key: SECRET_KEY
        generateValue: true
      
      - key: HOST
        value: "0.0.0.0"
      
      # PORT is provided by Render automatically, no need to set
      
      - key: MAX_FILE_SIZE
        value: "16777216"
      
      - key: ALLOWED_EXTENSIONS
        value: "png,jpg,jpeg"
      
      - key: SESSION_MAX_AGE
        value: "86400"
      
      - key: IMG_HEIGHT
        value: "224"
      
      - key: IMG_WIDTH
        value: "224"
      
      # TensorFlow optimization
      - key: TF_ENABLE_ONEDNN_OPTS
        value: "0"
      
      - key: TF_CPP_MIN_LOG_LEVEL
        value: "2"
    
    # Health check endpoint
    healthCheckPath: /api/health
    
    # Auto-deploy on push
    autoDeploy: true
    
    # Instance settings
    numInstances: 1

# Optional: Database (uncomment if needed)
# databases:
#   - name: plant-disease-db
#     databaseName: plant_disease
#     plan: free
#     region: oregon

# Optional: Redis (uncomment if needed for sessions)
# - type: redis
#   name: plant-disease-redis
#   plan: free
#   region: oregon
#   maxmemoryPolicy: allkeys-lru
